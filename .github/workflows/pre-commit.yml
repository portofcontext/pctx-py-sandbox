name: Pre-commit Checks

on:
  pull_request:
  push:
    branches: [main, develop]

jobs:
  pre-commit:
    name: Pre-commit Checks
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v7

      - name: Set up Python
        run: uv python install 3.11

      - name: Install dependencies
        run: make install

      - name: Run format and lint checks
        run: make check

      - name: Check imports
        run: |
          echo "Checking if package can be imported..."
          uv run python -c "
          from pctx_sandbox import (
              sandbox,
              sandbox_async,
              SandboxError,
              SandboxExecutionError,
          )
          print('✅ All imports successful')
          "

      - name: Security check
        run: |
          echo "Running security checks..."
          uv pip install bandit
          uv run bandit -r src/pctx_sandbox -ll || {
            echo "⚠️  Security issues found (non-blocking)"
          }
        continue-on-error: true
